---
title: "COVID-19 Death Trends via Demographics"
author: "Enzo Hamel, Jonny Quezada, Danielle Tran, Blake Zellmer"
date: March 31, 2022
subtitle: "Introduction to Data Science" 
output:
  pdf_document: default
  html_notebook: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.align='center')
```

**Data Background and Sources**:

Cases by County:https://data.cdc.gov/api/views/3nnm-4jni/rows.csv?accessType=DOWNLOAD

Vaccinations: https://data.cdc.gov/api/views/8xkx-amqh/rows.csv?accessType=DOWNLOAD

Sex Cases: blob:https://covid.cdc.gov/db3c6036-c87e-4e06-9de5-ee2a1bc5998e

Sex Deaths: blob:https://covid.cdc.gov/f08c19ba-ad20-48f5-8ce1-778769e947d7

Race Cases: blob:https://covid.cdc.gov/4b63d1c6-292b-423e-8981-e33a1960c88f 

Race Death: blob:https://covid.cdc.gov/d372dc55-a9c3-4a99-8c7a-edcb8a8b83b1

Age Cases: blob:https://covid.cdc.gov/0ae07c57-9ae8-44b8-b5c2-6cd29251df76

Age Deaths: blob:https://covid.cdc.gov/d7ce085e-1e8e-4d79-86bd-c796ad694374

https://covid.cdc.gov/covid-data-tracker/#demographics

**Information**

The CDC has a COVID data tracker that allows the public to easily look into data on COVID in many different forms and download it for personal use. A lot of the data deals with looking at the raw numbers and rates of infection and death via COVID, as well as vaccination numbers and rates. Most of the data does break down what it looks at by age, sex, race/ethnicity, and sometimes more like socio-economic status.

Additionally there has been a lot of research and analysis done on this data already. So one of the nice things about using the CDC COVID data tracker is being able to potentially compare our results or findings with what has been done already, if we look in the same direction. Otherwise it provides us with an idea of what’s something new potentially that can be done with the data.

All in all, the data is great because of how much there is and the specifics it provides. As well as being super current, often updated daily. Not to mention the data is coming from a very reliable source generally speaking. So there’s almost no issues as far as data quality should go, and there’s plenty of data to use in a variety of ways.

**Motivation**:

The dawn of the year 2020 brought about the rejuvenating birth of a new decade: a symbol of hope for a better future. However, unbeknownst to many, the specter of uncertainty loomed in the corner as the novel Coronavirus began its tour around the world in the later months that same year. As a result, society, as we know it, instantly changed for the foreseeable future; what we considered normal in day-to-day life before this pandemic has simply faded into a distant memory. Thus, in order to better understand the intricacies involved in this ongoing pandemic, we have decided to dedicate our project to analyzing data regarding the cases of the virus across the US, as well as taking a closer look at how the recent availability of vaccines have aided to diminish the spread of the virus.

**Research questions ideas**:

In the United States, which states have experienced the highest rates of infectivity?

In the United States, which counties have experienced the highest rates of infectivity?

Mask/Vaccine vs No Mask/Vaccine?

Is there a relationship between death rates and vaccine rates?
Have certain demographics had worse outcomes?

**REPORT (updates from the proposal)**:

**Address the issues in the proposal**

**Raw Data**

- We took the links above and turned into a csv data file.

- https://covid.cdc.gov/covid-data-tracker/#demographics 

- https://covid.cdc.gov/covid-data-tracker/#vaccination-demographic

- https://data.cdc.gov/Public-Health-Surveillance/United-States-COVID-19-Community-Levels-by-County/3nnm-4jni/data

**Research questions**

- We are studying the infectivity at the county level.

- We will create a map for all counties.

- In the United States, which states have experienced the highest rates of infectivity?

- In the United States, which counties have experienced the highest rates of infectivity?

- Mask/Vaccine vs No Mask/Vaccine?*

- Is there a relationship between death rates and vaccine rates?

- Have certain age, race/ethnicity, and race have worse outcomes?

- Demographics: We are looking at the age, race/ethnicity, and sex variables.

- Mask/No Mask data: We are unable to find the mask versus no mask data so we will not be studying that data. 
    

**Cases map**: 

- There are a quite a few of high spots across the United States. These pockets are located in ID, TX, AK, KY, LA. The county with the highest cases is Benewah County located in ID. The county with the second highest is Loving County located in TX. The county with the third highest is Nome Census Area located in AK. The other counties with hot spots are Wayne County in KY, Dillingham Census Area in AK, Comanche County in TX, Trigg County in KY, Caldwell Parish in LA, and Ochiltree County in TX.
```{r Read Data}
#Reading in the data
#knitr::opts_chunk$set(echo = FALSE)
#Blake's code:
#infection = read.csv("https://data.cdc.gov/api/views/3nnm-4jni/rows.csv?accessType=DOWNLOAD")
#vaccine = read.csv("https://data.cdc.gov/api/views/8xkx-amqh/rows.csv?accessType=DOWNLOAD")

infection = read.csv("/Users/jonnyquezada/Desktop/Spring 2022/IntroDataSci/United_States_COVID-19_Community_Levels_by_County.csv")
infection = data.frame(infection)
vaccine = read.csv("/Users/jonnyquezada/Desktop/Spring 2022/IntroDataSci/COVID-19_Vaccinations_in_the_United_States_County.csv")
vaccine = data.frame(vaccine)
```

```{r Clean Data, message=FALSE, warning=FALSE}
#Cleaning up the data, grabbing just the most recent numbers available
#and only the columns we want to look at.
library(dplyr)
vaccine$Date = as.Date(vaccine$Date, "%m/%d/%Y")
vaccine2 = vaccine %>%
          arrange(Date) %>%
          group_by(FIPS) %>%
          summarise(max = max(Date))
vdata = merge(vaccine, vaccine2, by.x = c("FIPS","Date"), by.y = c("FIPS","max")) %>% select(FIPS, Date:Administered_Dose1_Pop_Pct, Series_Complete_Yes, Series_Complete_Pop_Pct, Booster_Doses, Booster_Doses_Vax_Pct, Census2019)

infection$date_updated = as.Date(infection$date_updated)
infection2 = infection %>%
          arrange(date_updated) %>%
          group_by(county_fips) %>%
          summarise(max = max(date_updated))
idata = merge(infection, infection2, by.x = c("county_fips","date_updated"), by.y = c("county_fips", "max"))

df = merge(x=vdata, y=idata, by.x = "FIPS", by.y = "county_fips") %>%
  select(FIPS, Recip_County, Recip_State, total_population, health_service_area:covid.19_community_level, Completeness_pct:Booster_Doses_Vax_Pct)

df = df %>% rename(fips = FIPS)
```

```{r Examine Data1, message=FALSE, warning=FALSE}
library(usmap)
library(ggplot2)
#Plot of covid cases by county
plot_usmap(regions = "counties", data = df, values = "covid_cases_per_100k") + 
           scale_fill_continuous(low = "white", high = "red") + 
  labs(title = "Current Covid cases by Counties",
       subtitle = "This shows what counties are experiencing high covid cases.") + 
  theme(panel.background = element_rect(color = "black"))
```

**Booster Dose map**:

- From the overall look of the map, the South has the lowest percentage of booster doses. The states with counties with the highest percentage of booster doses are in NY, CA, WA, NE, MN, NM, CO.
```{r Examine Data2, message=FALSE, warning=FALSE}
library(usmap)
library(ggplot2)
#Plot of vaccines by county
plot_usmap(regions = "counties", data = df, values = "Booster_Doses_Vax_Pct") + 
           scale_fill_continuous(low = "white", high = "darkblue") + 
  labs(title = "Current Booster Doses by Counties",
       subtitle = "This shows what counties have high percentages of vaccination.") + 
  theme(panel.background = element_rect(color = "black"))

```

**Cases and Deaths by Race and Ethnicity**:

- This next plot describes and compares the percent of cases against the percent of deaths due to COVID in the US for various races and ethnicities. Most interestingly, these two plots share a similar distribution, with white non-hispanics earning the majority, and Native Hawaiian/Pacific Islander earning the lowest percentage.  
```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(gridExtra)
# type file.choose() into the R console to find your directory of the csv
# will need to erase first two lines of original csv for code to work

csv1 = "/Users/jonnyquezada/Desktop/Spring 2022/IntroDataSci/cases_by_race_ethnicity__all_age_groups.csv"
csv2 = "/Users/jonnyquezada/Desktop/Spring 2022/IntroDataSci/deaths_by_race_ethnicity__all_age_groups.csv"

CasesRaceE = read.csv(file=csv1)
CasesRaceE = data.frame(CasesRaceE)

DeathsRaceE = read.csv(file=csv2)
DeathsRaceE = data.frame(DeathsRaceE)


plot1 = ggplot(CasesRaceE, aes(x = Race.Ethnicity, y = Percent.of.cases, fill=Percent.of.cases)) + geom_bar(stat = "identity") + coord_flip() + ylab("Percent of Cases") + xlab("Race/Ethnicity") + scale_fill_continuous(name = "Percent of Cases")

plot2 = ggplot(DeathsRaceE, aes(x = Race.Ethnicity, y = Percent.of.deaths, fill=Percent.of.deaths)) + geom_bar(stat = "identity") + coord_flip() + ylab("Percent of Deaths") + xlab("Race/Ethnicity") + scale_fill_continuous(name = "Percent of Deaths")

grid.arrange(plot1, plot2)
```

**Cases and Deaths by Sex**:

- This next plot describes and compares the percent of cases against the percent of deaths due to COVID in the US for the demographic of sex. For the category of sex known as "other", the original dataset gave non-numerical value of <0.1. For the sake of cohesiveness in the plot, we rounded all such values to 0.1.

```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(gridExtra)
# type file.choose() into the R console to find your directory of the csv
# will need to erase first two lines of original csv for code to work

csv1_2 = "/Users/jonnyquezada/Downloads/cases_by_sex__all_age_groups.csv"
csv2_2 = "/Users/jonnyquezada/Downloads/deaths_by_sex__all_age_groups.csv"

CasesSex = read.csv(file=csv1_2)
CasesSex = data.frame(CasesSex)

DeathsSex = read.csv(file=csv2_2)
DeathsSex = data.frame(DeathsSex)


plot1_2 = ggplot(CasesSex, aes(x = Sex, y = Percent.of.cases, fill=Percent.of.cases)) + geom_bar(stat = "identity") + coord_flip() + ylab("Percent of Cases") + xlab("Sex") + scale_fill_continuous(name = "Percent of Cases")

plot2_2 = ggplot(DeathsSex, aes(x = Sex, y = Percentage.of.deaths, fill=Percentage.of.deaths)) + geom_bar(stat = "identity") + coord_flip() + ylab("Percent of Deaths") + xlab("Sex") + scale_fill_continuous(name = "Percent of Deaths")

grid.arrange(plot1_2, plot2_2)
```

**Cases and Deaths by Age Groups**:

- This next plot describes and compares the percent of cases against the percent of deaths due to COVID in the US for various age groups. It should be noted that in the plot of percentage of deaths per age groups, the age groups of 5-11 years, 12-15 years, and 16-17 years all had values less than 0.1 percent in the original dataset. For the sake of cohesiveness in the plot, all such values have been rounded to 0.1.

```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(gridExtra)
# type file.choose() into the R console to find your directory of the csv
# will need to erase first two lines of original csv for code to work

csv1_3 = "/Users/jonnyquezada/Downloads/cases_by_age_group.csv"
csv2_3 = "/Users/jonnyquezada/Downloads/deaths_by_age_group.csv"

CasesAge = read.csv(file=csv1_3)
CasesAge = data.frame(CasesAge)

DeathsAge = read.csv(file=csv2_3)
DeathsAge = data.frame(DeathsAge)


plot1_3 = ggplot(CasesAge, aes(x = Age.Group, y = Percent.of.cases, fill=Percent.of.cases)) + geom_bar(stat = "identity") + coord_flip() + ylab("Percent of Cases") + xlab("Age Group") + scale_fill_continuous(name = "Percent of Cases")

plot2_3 = ggplot(DeathsAge, aes(x = Age.Group, y = Percentage.of.deaths, fill=Percentage.of.deaths)) + geom_bar(stat = "identity") + coord_flip() + ylab("Percent of Deaths") + xlab("Age Group") + scale_fill_continuous(name = "Percent of Deaths")

grid.arrange(plot1_3, plot2_3)
```

















```{r}
library(jsonlite)
library(ggplot2)
library(RSocrata)

# data_1 = jsonlite::fromJSON("https://data.cdc.gov/resource/n8mc-b4w4.json")
#vaccine_data = read.socrata("https://data.cdc.gov/resource/3rge-nu2a.json")

#vaccine_data = data.frame(vaccine_data)

#vaccine_data

#plot_vac = ggplot(vaccine_data, aes(x=month, y=crude_vax_ir)) + geom_bar(stat = "identity") #+ scale_y_discrete(guide = guide_axis(n.dodge=8))

#plot_vac

```




```{r}
library(jsonlite)
library(ggplot2)
library(RSocrata)

# data_1 = jsonlite::fromJSON("https://data.cdc.gov/resource/n8mc-b4w4.json")
#data_1 = read.socrata("https://data.cdc.gov/resource/n8mc-b4w4.json")

#data_1 = data.frame(data_1)

#data_1

#plot_1 = ggplot(data_1, aes(case_positive_specimen)) + geom_bar(stat = "count") + coord_flip() + scale_y_discrete(guide = guide_axis(n.dodge=8)) + facet_wrap(~ethnicity)

#plot_1

```


```{r}
library(ggplot2)
library(gridExtra)

#csv_3 = "/Users/jonnyquezada/Downloads/COVID-19_Case_Surveillance_Public_Use_Data_with_Geography.csv"

#CasesRaceE_2 = read.csv(file=csv_3)
#CasesRaceE_2 = data.frame(CasesRaceE_2)

#CasesRaceE_2

#plot3 = ggplot(CasesRaceE_2, aes(x = Race.Ethnicity, y = Percent.of.cases, fill=Percent.of.cases)) + geom_bar(stat = "identity") + coord_flip() + ylab("Percent of Cases") + xlab("Race/Ethnicity")

#plot3
```

```{r}
#plot3 = ggplot(CasesRaceE_2, aes(x = Race.Ethnicity, y = Percent.of.cases, fill=Percent.of.cases)) + geom_bar(stat = "identity") + coord_flip() + ylab("Percent of Cases") + xlab("Race/Ethnicity")

#plot3

#plot_1 = ggplot(CasesRaceE_2, aes(death_yn)) + geom_bar(stat = "count") + coord_flip() + scale_y_discrete(guide = guide_axis(n.dodge=8))

#plot_1
```



**Updated scheduled** (Clearly describes what has been done and what will be completed in the final report.)

- April 3 - April 16:
  - Research more and go in-depth with plots.
- April 17 - April 30:
  - Research more, go in-depth with plots, and finalize.
- May 1 - May 13 (Final report & presentation Due: May 11):
  - Finalize and present final project.




